<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Live Binance Pump Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <style>
    body { background-color: #0b0f19; }
  </style>
</head>
<body class="min-h-screen text-white flex flex-col items-center py-6 px-3">
  <div class="w-full max-w-md">
    <h1 class="text-2xl font-bold mb-2 text-yellow-400 text-center">üöÄ Live Pump Tracker</h1>
    <p class="mb-4 text-gray-300 text-center text-sm">
      Short signals for pumped USDT perpetual futures (live from Binance)
    </p>

    <div class="flex justify-between items-center mb-4">
      <button id="refreshBtn" class="px-4 py-2 bg-yellow-500 rounded-lg font-semibold text-gray-900 shadow-md active:bg-yellow-400 text-sm">
        üîÑ Refresh
      </button>
      <span id="lastUpdate" class="text-xs text-gray-400"></span>
    </div>

    <div id="errorBox" class="hidden bg-red-800 border border-red-600 rounded-lg p-3 mb-4 text-red-200 text-sm"></div>

    <div id="list" class="space-y-3">
      <div id="loading" class="bg-gray-800 rounded-lg p-4 text-center text-gray-400">
        Loading live data...
      </div>
    </div>

    <footer class="mt-8 text-xs text-gray-500 text-center">
      ‚ö†Ô∏è Educational use only. Not financial advice.<br/>
      Data: Binance Futures API | Auto-refresh every 5 min
    </footer>
  </div>

  <script>
    const refreshBtn = document.getElementById('refreshBtn');
    const lastUpdate = document.getElementById('lastUpdate');
    const list = document.getElementById('list');
    const errorBox = document.getElementById('errorBox');
    const loading = document.getElementById('loading');

    function formatPrice(p) {
      const n = Number(p);
      if (n >= 1) return n.toFixed(2);
      if (n >= 0.01) return n.toFixed(4);
      return n.toFixed(6);
    }

    function showError(msg) {
      errorBox.textContent = msg;
      errorBox.classList.remove('hidden');
    }

    function hideError() {
      errorBox.classList.add('hidden');
      errorBox.textContent = '';
    }

    async function fetchLiveData() {
      refreshBtn.disabled = true;
      refreshBtn.textContent = 'üîÑ Loading...';
      hideError();

      try {
        // Get exchange info for symbols
        const exRes = await fetch('https://fapi.binance.com/fapi/v1/exchangeInfo');
        const exData = await exRes.json();
        const usdtSymbols = exData.symbols
          .filter(s => s.symbol.endsWith('USDT') && s.status === 'TRADING')
          .slice(0, 40) // scan first 40 for speed
          .map(s => s.symbol);

        // 24h ticker
        const tRes = await fetch('https://fapi.binance.com/fapi/v1/ticker/24hr');
        const tData = await tRes.json();

        // Filter pumped
        const pumped = tData
          .filter(t => usdtSymbols.includes(t.symbol))
          .filter(t => Number(t.priceChangePercent) >= 15)
          .sort((a,b) => Number(b.priceChangePercent) - Number(a.priceChangePercent))
          .slice(0, 12);

        const analyses = await Promise.all(pumped.map(async (t) => {
          const symbol = t.symbol;
          const currentPrice = Number(t.lastPrice);
          const pumpPercent = Number(t.priceChangePercent);
          // volumeChangePercent doesn't exist for futures ticker; approximate via quoteVolume vs. previous periods would need more calls.
          const volume = Number(t.volume);

          // 1h klines for last 24 candles
          const kRes = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=1h&limit=24`);
          const klines = await kRes.json();
          const closes = klines.map(k => Number(k[4]));
          const highs = klines.map(k => Number(k[2]));
          const recentHigh = Math.max(...highs.slice(-6));

          // Simple RSI approximation (14)
          const gains = [], losses = [];
          for (let i=1; i<closes.length; i++) {
            const ch = closes[i] - closes[i-1];
            gains.push(ch > 0 ? ch : 0);
            losses.push(ch < 0 ? -ch : 0);
          }
          const last14g = gains.slice(-14).reduce((a,b)=>a+b,0)/14 || 0;
          const last14l = losses.slice(-14).reduce((a,b)=>a+b,0)/14 || 0;
          const rs = last14l === 0 ? Infinity : last14g / last14l;
          const rsi = last14l === 0 ? 100 : 100 - (100/(1+rs));

          // Confidence score
          let conf = 0;
          const reasons = [];
          if (pumpPercent >= 20) { conf += 25; reasons.push(`Strong pump (+${pumpPercent.toFixed(1)}%)`); }
          else if (pumpPercent >= 15) { conf += 15; reasons.push(`Moderate pump (+${pumpPercent.toFixed(1)}%)`); }

          if (rsi > 70) { conf += 20; reasons.push(`RSI overbought (${rsi.toFixed(1)})`); }
          if (currentPrice >= recentHigh * 0.95) { conf += 15; reasons.push('Near recent high'); }

          // Stop/TPs
          const entry = currentPrice;
          const sl = entry * 1.05;
          const tp1 = entry * 0.90;
          const tp2 = entry * 0.80;

          return {
            symbol, entry, sl, tp1, tp2,
            confidence: Math.min(100, Math.round(conf)),
            rsi, pumpPercent, volume
          };
        }));

        const signals = analyses
          .filter(x => x.confidence >= 50)
          .sort((a,b) => b.confidence - a.confidence);

        // Render
        list.innerHTML = '';
        if (signals.length === 0) {
          list.innerHTML = `
            <div class="bg-gray-800 rounded-lg p-4 text-center text-gray-400">
              No strong short signals found. Try again later.
            </div>`;
        } else {
          signals.forEach(s => {
            const card = document.createElement('div');
            card.className = 'bg-gray-800 rounded-xl p-4 shadow-lg border border-yellow-700';
            card.innerHTML = `
              <div class="flex items-center justify-between mb-2">
                <span class="text-lg font-bold text-yellow-300">${s.symbol}</span>
                <div class="text-right">
                  <div class="text-xs text-green-400">+${s.pumpPercent.toFixed(1)}% pump</div>
                </div>
              </div>
              <div class="grid grid-cols-2 gap-2 mb-3 text-xs">
                <div class="bg-gray-700 p-2 rounded">
                  <div class="text-gray-400">Entry</div>
                  <div class="text-white font-mono">$${formatPrice(s.entry)}</div>
                </div>
                <div class="bg-red-900 p-2 rounded">
                  <div class="text-red-300">Stop Loss</div>
                  <div class="text-red-200 font-mono">$${formatPrice(s.sl)}</div>
                </div>
                <div class="bg-green-900 p-2 rounded">
                  <div class="text-green-300">TP1 (-10%)</div>
                  <div class="text-green-200 font-mono">$${formatPrice(s.tp1)}</div>
                </div>
                <div class="bg-green-800 p-2 rounded">
                  <div class="text-green-300">TP2 (-20%)</div>
                  <div class="text-green-200 font-mono">$${formatPrice(s.tp2)}</div>
                </div>
              </div>
              <div class="flex items-center justify-between mb-2">
                <span class="bg-yellow-900 text-yellow-300 px-2 py-1 rounded text-xs font-semibold">
                  Confidence: ${s.confidence}%
                </span>
                <span class="text-xs text-gray-400">
                  RSI: ${s.rsi.toFixed(1)}
                </span>
              </div>
            `;
            list.appendChild(card);
          });
        }

        lastUpdate.textContent = 'Updated: ' + new Date().toLocaleString();
      } catch (e) {
        console.error(e);
        showError('Failed to fetch live data. Tap Refresh to try again.');
      } finally {
        refreshBtn.disabled = false;
        refreshBtn.textContent = 'üîÑ Refresh';
        if (loading) loading.remove();
      }
    }

    refreshBtn.addEventListener('click', fetchLiveData);
    // Auto-refresh every 5 minutes
    setInterval(fetchLiveData, 5 * 60 * 1000);
    // Initial fetch
    fetchLiveData();
  </script>
</body>
</html>
